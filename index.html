<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            gap: 5px;
            overflow-x: auto;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .tab-content {
            display: none;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 5px;
        }

        .header .datetime {
            opacity: 0.7;
            font-size: 1.1rem;
        }

        .header .hebrew-date {
            opacity: 0.6;
            font-size: 0.95rem;
            margin-top: 5px;
        }

        /* Search Bar */
        .search-bar {
            max-width: 600px;
            margin: 20px auto;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 16px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            backdrop-filter: blur(10px);
        }

        .search-bar input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-bar input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Shortcuts Grid */
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
        }

        .shortcut {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #fff;
        }

        .shortcut:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }

        .shortcut-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .shortcut-name {
            font-size: 0.85rem;
            text-align: center;
            opacity: 0.9;
        }

        .add-shortcut {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            background: transparent;
        }

        .add-shortcut .shortcut-icon {
            background: transparent;
            font-size: 1.8rem;
            opacity: 0.4;
        }

        /* Colors */
        .color-1 { background: linear-gradient(135deg, #667eea, #764ba2); }
        .color-2 { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .color-3 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .color-4 { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .color-5 { background: linear-gradient(135deg, #fa709a, #fee140); }
        .color-6 { background: linear-gradient(135deg, #a8edea, #fed6e3); }
        .color-7 { background: linear-gradient(135deg, #ff9a9e, #fecfef); }
        .color-8 { background: linear-gradient(135deg, #ffecd2, #fcb69f); }

        /* News Section */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .news-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            overflow: hidden;
        }

        .news-category-header {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.08);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .news-list {
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .news-item {
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
            display: block;
            text-decoration: none;
            color: #fff;
        }

        .news-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .news-item-title {
            font-size: 0.95rem;
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .news-item-meta {
            font-size: 0.8rem;
            opacity: 0.5;
        }

        .news-loading {
            text-align: center;
            padding: 40px;
            opacity: 0.5;
        }

        /* Weather Widget */
        .weather-widget {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .weather-main {
            text-align: center;
            min-width: 150px;
        }

        .weather-temp {
            font-size: 4rem;
            font-weight: 200;
            line-height: 1;
        }

        .weather-icon {
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .weather-desc {
            opacity: 0.7;
            text-transform: capitalize;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            flex: 1;
        }

        .weather-detail {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .weather-detail-value {
            font-size: 1.3rem;
            font-weight: 500;
        }

        .weather-detail-label {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-top: 5px;
        }

        .weather-forecast {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .forecast-day {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 100px;
        }

        .forecast-day-name {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 8px;
        }

        .forecast-day-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .forecast-day-temp {
            font-weight: 500;
        }

        .forecast-day-temp-min {
            opacity: 0.5;
            font-size: 0.85rem;
        }

        /* Notes Section */
        .notes-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .notes-container {
                grid-template-columns: 1fr;
            }
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 500px;
            overflow-y: auto;
        }

        .note-item {
            background: rgba(255, 255, 255, 0.06);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .note-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .note-item.active {
            background: rgba(255, 255, 255, 0.12);
            border-left: 3px solid #4facfe;
        }

        .note-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .note-preview {
            font-size: 0.85rem;
            opacity: 0.6;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-date {
            font-size: 0.75rem;
            opacity: 0.4;
            margin-top: 5px;
        }

        .note-editor {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .note-editor input {
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 10px;
            color: #fff;
        }

        .note-editor textarea {
            flex: 1;
            min-height: 350px;
            padding: 15px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 10px;
            color: #fff;
            resize: none;
            line-height: 1.6;
        }

        .note-editor input:focus,
        .note-editor textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
        }

        .note-actions {
            display: flex;
            gap: 10px;
        }

        /* Todo Section */
        .todo-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .todo-input-container input {
            flex: 1;
            padding: 14px 18px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 10px;
            color: #fff;
        }

        .todo-input-container input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.12);
        }

        .todo-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            transition: all 0.2s;
        }

        .todo-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .todo-item.completed {
            opacity: 0.5;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
        }

        .todo-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .todo-item.completed .todo-checkbox {
            background: #4facfe;
            border-color: #4facfe;
        }

        .todo-text {
            flex: 1;
        }

        .todo-delete {
            opacity: 0;
            cursor: pointer;
            padding: 5px;
            transition: opacity 0.2s;
        }

        .todo-item:hover .todo-delete {
            opacity: 0.5;
        }

        .todo-delete:hover {
            opacity: 1 !important;
        }

        /* Currency Widget */
        .currency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .currency-card {
            background: rgba(255, 255, 255, 0.06);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .currency-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
        }

        .currency-info {
            flex: 1;
        }

        .currency-name {
            font-size: 0.85rem;
            opacity: 0.6;
        }

        .currency-value {
            font-size: 1.4rem;
            font-weight: 500;
        }

        .currency-change {
            font-size: 0.85rem;
            margin-top: 3px;
        }

        .currency-change.up {
            color: #43e97b;
        }

        .currency-change.down {
            color: #f5576c;
        }

        /* Jewish Calendar */
        .jewish-calendar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .shabbat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            padding: 25px;
            border-radius: 16px;
            text-align: center;
        }

        .shabbat-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .shabbat-times {
            display: flex;
            justify-content: center;
            gap: 40px;
        }

        .shabbat-time {
            text-align: center;
        }

        .shabbat-time-label {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .shabbat-time-value {
            font-size: 1.8rem;
            font-weight: 300;
        }

        .parasha-card {
            background: rgba(255, 255, 255, 0.06);
            padding: 25px;
            border-radius: 16px;
        }

        .parasha-name {
            font-size: 1.5rem;
            margin: 15px 0 10px;
        }

        .parasha-hebrew {
            font-size: 2rem;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .holidays-list {
            margin-top: 10px;
        }

        .holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .holiday-item:last-child {
            border-bottom: none;
        }

        .holiday-name {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .holiday-hebrew {
            font-size: 0.85rem;
            opacity: 0.6;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.06);
            padding: 25px;
            border-radius: 16px;
            text-align: center;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.6;
        }

        .quick-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quick-link {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            text-decoration: none;
            color: #fff;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-link:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4361ee;
            color: #fff;
        }

        .btn-primary:hover {
            background: #3a56d4;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: #e63946;
            color: #fff;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        /* Refresh button */
        .refresh-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 5px;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .refresh-btn:hover {
            color: #fff;
        }

        .refresh-btn.loading {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1e2746;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            margin-bottom: 25px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .color-option:hover,
        .color-option.selected {
            transform: scale(1.1);
            border-color: #fff;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-buttons .btn {
            flex: 1;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .setting-description {
            font-size: 0.85rem;
            opacity: 0.5;
        }

        .toggle {
            width: 50px;
            height: 28px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .toggle.active {
            background: #4361ee;
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: all 0.3s;
        }

        .toggle.active::after {
            left: 25px;
        }

        /* API Key input */
        .api-key-section {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .api-key-section h3 {
            color: #ffc107;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .api-key-section p {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .api-key-section a {
            color: #4facfe;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Error message */
        .error-message {
            background: rgba(229, 57, 70, 0.2);
            border: 1px solid rgba(229, 57, 70, 0.5);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                padding: 10px;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .weather-widget {
                flex-direction: column;
            }

            .shabbat-times {
                flex-direction: column;
                gap: 20px;
            }

            .news-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1 id="greeting">Bonjour üëã</h1>
        <div class="datetime" id="datetime"></div>
        <div class="hebrew-date" id="hebrewDate"></div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="üîç Rechercher sur Google..." />
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="home">üè† Accueil</button>
        <button class="nav-tab" data-tab="news">üì∞ Actualit√©s</button>
        <button class="nav-tab" data-tab="dashboard">üìä Dashboard</button>
        <button class="nav-tab" data-tab="weather">‚òÄÔ∏è M√©t√©o</button>
        <button class="nav-tab" data-tab="notes">üìù Notes</button>
        <button class="nav-tab" data-tab="currency">üíπ Devises</button>
        <button class="nav-tab" data-tab="calendar">üïé Calendrier</button>
        <button class="nav-tab" data-tab="settings">‚öôÔ∏è Param√®tres</button>
    </nav>

    <!-- Home Tab -->
    <div class="tab-content active" id="home">
        <div id="shortcuts-container"></div>
        <button class="btn btn-secondary" onclick="openCategoryModal()" style="margin-top: 20px;">
            + Ajouter une cat√©gorie
        </button>
    </div>

    <!-- News Tab -->
    <div class="tab-content" id="news">
        <div class="news-grid">
            <div class="news-category">
                <div class="news-category-header">üá´üá∑ Actualit√©s France</div>
                <div class="news-list" id="news-france">
                    <div class="news-loading">Chargement...</div>
                </div>
            </div>
            <div class="news-category">
                <div class="news-category-header">üíº Business & √âconomie</div>
                <div class="news-list" id="news-business">
                    <div class="news-loading">Chargement...</div>
                </div>
            </div>
            <div class="news-category">
                <div class="news-category-header">üíª Tech & Innovation</div>
                <div class="news-list" id="news-tech">
                    <div class="news-loading">Chargement...</div>
                </div>
            </div>
            <div class="news-category">
                <div class="news-category-header">üå± √ânergie & Environnement</div>
                <div class="news-list" id="news-energy">
                    <div class="news-loading">Chargement...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Tab -->
    <div class="tab-content" id="dashboard">
        <div class="card">
            <div class="card-header">
                <span class="card-title">üîó Acc√®s rapide</span>
            </div>
            <div class="quick-links">
                <a href="https://admin.shopify.com" target="_blank" class="quick-link">üõçÔ∏è Shopify Admin</a>
                <a href="https://analytics.google.com" target="_blank" class="quick-link">üìà Google Analytics</a>
                <a href="https://search.google.com/search-console" target="_blank" class="quick-link">üîç Search Console</a>
                <a href="https://business.facebook.com" target="_blank" class="quick-link">üìò Meta Business</a>
                <a href="https://ads.google.com" target="_blank" class="quick-link">üì£ Google Ads</a>
                <a href="https://mail.google.com" target="_blank" class="quick-link">‚úâÔ∏è Gmail</a>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title">üìã T√¢ches du jour</span>
            </div>
            <div class="todo-input-container">
                <input type="text" id="todoInput" placeholder="Ajouter une t√¢che..." />
                <button class="btn btn-primary" onclick="addTodo()">Ajouter</button>
            </div>
            <div class="todo-list" id="todoList"></div>
        </div>
    </div>

    <!-- Weather Tab -->
    <div class="tab-content" id="weather">
        <div class="card">
            <div class="card-header">
                <span class="card-title">üå§Ô∏è M√©t√©o actuelle - <span id="weatherCityDisplay">Paris</span></span>
                <button class="refresh-btn" onclick="loadWeather()" id="weatherRefresh">üîÑ</button>
            </div>
            <div class="weather-widget" id="weatherWidget">
                <div class="news-loading">Chargement de la m√©t√©o...</div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìÖ Pr√©visions 5 jours</span>
            </div>
            <div class="weather-forecast" id="weatherForecast"></div>
        </div>
    </div>

    <!-- Notes Tab -->
    <div class="tab-content" id="notes">
        <div class="notes-container">
            <div>
                <div class="card-header">
                    <span class="card-title">üìù Mes notes</span>
                    <button class="btn btn-primary btn-sm" onclick="createNote()">+ Nouvelle</button>
                </div>
                <div class="notes-list" id="notesList"></div>
            </div>
            <div class="note-editor card" id="noteEditor" style="display: none;">
                <input type="text" id="noteTitle" placeholder="Titre de la note..." />
                <textarea id="noteContent" placeholder="√âcrivez votre note ici..."></textarea>
                <div class="note-actions">
                    <button class="btn btn-primary" onclick="saveNote()">üíæ Enregistrer</button>
                    <button class="btn btn-danger" onclick="deleteNote()">üóëÔ∏è Supprimer</button>
                </div>
            </div>
            <div class="card" id="noteEditorPlaceholder">
                <div style="text-align: center; padding: 50px; opacity: 0.5;">
                    S√©lectionnez une note ou cr√©ez-en une nouvelle
                </div>
            </div>
        </div>
    </div>

    <!-- Currency Tab -->
    <div class="tab-content" id="currency">
        <div class="card">
            <div class="card-header">
                <span class="card-title">üí± Taux de change (base EUR)</span>
                <button class="refresh-btn" onclick="loadCurrency()" id="currencyRefresh">üîÑ</button>
            </div>
            <div class="currency-grid" id="currencyGrid">
                <div class="news-loading">Chargement des taux...</div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <span class="card-title">‚Çø Cryptomonnaies</span>
                <button class="refresh-btn" onclick="loadCrypto()" id="cryptoRefresh">üîÑ</button>
            </div>
            <div class="currency-grid" id="cryptoGrid">
                <div class="news-loading">Chargement...</div>
            </div>
        </div>
    </div>

    <!-- Jewish Calendar Tab -->
    <div class="tab-content" id="calendar">
        <div class="jewish-calendar">
            <div class="shabbat-card">
                <div class="shabbat-title">üïØÔ∏è Horaires Shabbat - <span id="shabbatCity">Paris</span></div>
                <div class="shabbat-times">
                    <div class="shabbat-time">
                        <div class="shabbat-time-label">Allumage des bougies</div>
                        <div class="shabbat-time-value" id="shabbatIn">--:--</div>
                    </div>
                    <div class="shabbat-time">
                        <div class="shabbat-time-label">Sortie de Shabbat</div>
                        <div class="shabbat-time-value" id="shabbatOut">--:--</div>
                    </div>
                </div>
            </div>
            <div class="parasha-card">
                <div class="card-title">üìñ Paracha de la semaine</div>
                <div class="parasha-name" id="parashaName">--</div>
                <div class="parasha-hebrew" id="parashaHebrew">--</div>
            </div>
        </div>
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <span class="card-title">üìÖ Prochaines f√™tes et √©v√©nements</span>
            </div>
            <div class="holidays-list" id="holidaysList">
                <div class="news-loading">Chargement...</div>
            </div>
        </div>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content" id="settings">
        <div class="card">
            <div class="api-key-section">
                <h3>üîë Cl√© API OpenWeatherMap (pour la m√©t√©o)</h3>
                <p>Obtenez une cl√© gratuite sur <a href="https://openweathermap.org/api" target="_blank">openweathermap.org</a></p>
                <div class="form-group" style="margin-bottom: 0;">
                    <input type="text" id="weatherApiKey" placeholder="Votre cl√© API OpenWeatherMap..." />
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">üìç Localisation</div>
                <div class="form-group">
                    <label>Ville pour la m√©t√©o</label>
                    <input type="text" id="weatherCity" placeholder="Paris" />
                </div>
                <div class="form-group">
                    <label>Ville pour les horaires Shabbat</label>
                    <select id="jewishCity">
                        <option value="Paris">Paris</option>
                        <option value="Marseille">Marseille</option>
                        <option value="Lyon">Lyon</option>
                        <option value="Nice">Nice</option>
                        <option value="Strasbourg">Strasbourg</option>
                        <option value="Jerusalem">J√©rusalem</option>
                        <option value="Tel Aviv">Tel Aviv</option>
                        <option value="New York">New York</option>
                        <option value="London">Londres</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="saveSettings()">üíæ Enregistrer les param√®tres</button>
            </div>

            <div class="settings-section">
                <div class="settings-title">üë§ Personnalisation</div>
                <div class="form-group">
                    <label>Votre pr√©nom (pour le message de bienvenue)</label>
                    <input type="text" id="userName" placeholder="Ishay" />
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">üíæ Donn√©es</div>
                <div class="setting-item">
                    <div class="setting-label">
                        <span>Exporter mes donn√©es</span>
                        <span class="setting-description">T√©l√©charger toutes vos donn√©es en JSON</span>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="exportData()">Exporter</button>
                </div>
                <div class="setting-item">
                    <div class="setting-label">
                        <span>Importer des donn√©es</span>
                        <span class="setting-description">Restaurer depuis un fichier JSON</span>
                    </div>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)" />
                    <button class="btn btn-secondary btn-sm" onclick="document.getElementById('importFile').click()">Importer</button>
                </div>
                <div class="setting-item">
                    <div class="setting-label">
                        <span>R√©initialiser</span>
                        <span class="setting-description">Supprimer toutes les donn√©es</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="resetData()">R√©initialiser</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shortcut Modal -->
    <div class="modal-overlay" id="shortcutModal">
        <div class="modal">
            <h2 id="shortcutModalTitle">Ajouter un raccourci</h2>
            <div class="form-group">
                <label>Nom du site</label>
                <input type="text" id="siteName" placeholder="Ex: Les Artisans Verts" />
            </div>
            <div class="form-group">
                <label>URL du site</label>
                <input type="url" id="siteUrl" placeholder="https://exemple.com" />
            </div>
            <div class="form-group">
                <label>Couleur</label>
                <div class="color-picker">
                    <div class="color-option color-1 selected" data-color="color-1"></div>
                    <div class="color-option color-2" data-color="color-2"></div>
                    <div class="color-option color-3" data-color="color-3"></div>
                    <div class="color-option color-4" data-color="color-4"></div>
                    <div class="color-option color-5" data-color="color-5"></div>
                    <div class="color-option color-6" data-color="color-6"></div>
                    <div class="color-option color-7" data-color="color-7"></div>
                    <div class="color-option color-8" data-color="color-8"></div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeShortcutModal()">Annuler</button>
                <button class="btn btn-primary" onclick="saveShortcut()">Enregistrer</button>
            </div>
            <button class="btn btn-danger" id="deleteShortcutBtn" style="display: none; width: 100%; margin-top: 10px;" onclick="deleteShortcut()">Supprimer</button>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal">
        <div class="modal">
            <h2>Ajouter une cat√©gorie</h2>
            <div class="form-group">
                <label>Nom de la cat√©gorie</label>
                <input type="text" id="categoryName" placeholder="Ex: üíº Travail, üéÆ Perso..." />
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeCategoryModal()">Annuler</button>
                <button class="btn btn-primary" onclick="saveCategory()">Cr√©er</button>
            </div>
        </div>
    </div>

    <script>
        // ============ DEFAULT DATA ============
        const defaultData = {
            categories: [
                {
                    id: 'work',
                    name: 'üíº Travail',
                    shortcuts: [
                        { id: '1', name: 'Les Artisans Verts', url: 'https://lesartisansverts.fr', color: 'color-4' },
                        { id: '2', name: 'ChabadClub', url: 'https://chabadclub.org', color: 'color-1' },
                        { id: '3', name: 'Sneakers Heat', url: 'https://sneakers-heat.com', color: 'color-5' },
                        { id: '4', name: 'Shopify Admin', url: 'https://admin.shopify.com', color: 'color-3' }
                    ]
                },
                {
                    id: 'tools',
                    name: 'üõ†Ô∏è Outils',
                    shortcuts: [
                        { id: '5', name: 'GitHub', url: 'https://github.com', color: 'color-6' },
                        { id: '6', name: 'Gmail', url: 'https://mail.google.com', color: 'color-2' },
                        { id: '7', name: 'Google Drive', url: 'https://drive.google.com', color: 'color-3' },
                        { id: '8', name: 'Claude AI', url: 'https://claude.ai', color: 'color-1' }
                    ]
                }
            ],
            notes: [],
            todos: [],
            settings: {
                weatherCity: 'Paris',
                jewishCity: 'Paris',
                userName: 'Ishay',
                weatherApiKey: ''
            }
        };

        let data = JSON.parse(localStorage.getItem('dashboardDataV2')) || defaultData;
        let editingShortcut = null;
        let currentCategoryId = null;
        let selectedColor = 'color-1';
        let currentNoteId = null;

        // ============ RSS PROXY ============
        const RSS_PROXY = 'https://api.rss2json.com/v1/api.json?rss_url=';

        // ============ INITIALIZATION ============
        function init() {
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            // Load settings into form
            document.getElementById('weatherCity').value = data.settings.weatherCity || 'Paris';
            document.getElementById('jewishCity').value = data.settings.jewishCity || 'Paris';
            document.getElementById('userName').value = data.settings.userName || '';
            document.getElementById('weatherApiKey').value = data.settings.weatherApiKey || '';
            
            renderShortcuts();
            renderTodos();
            renderNotes();
            
            loadNews();
            loadWeather();
            loadCurrency();
            loadCrypto();
            loadJewishCalendar();
            
            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });

            // Search
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(e.target.value)}`, '_blank');
                    e.target.value = '';
                }
            });

            // Todo input
            document.getElementById('todoInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTodo();
            });

            // Color picker
            document.querySelectorAll('.color-option').forEach(el => {
                el.addEventListener('click', () => selectColor(el.dataset.color));
            });

            // Close modals on outside click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) overlay.classList.remove('active');
                });
            });

            // Auto-save notes
            document.getElementById('noteTitle').addEventListener('input', debounce(saveNote, 1000));
            document.getElementById('noteContent').addEventListener('input', debounce(saveNote, 1000));
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ============ DATE & TIME ============
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' };
            document.getElementById('datetime').textContent = now.toLocaleDateString('fr-FR', options);
            
            // Update greeting
            const hour = now.getHours();
            let greeting = 'Bonjour';
            if (hour >= 18) greeting = 'Bonsoir';
            else if (hour < 6) greeting = 'Bonne nuit';
            
            const name = data.settings.userName || '';
            document.getElementById('greeting').textContent = `${greeting}${name ? ', ' + name : ''} üëã`;
        }

        // ============ SHORTCUTS ============
        function renderShortcuts() {
            const container = document.getElementById('shortcuts-container');
            container.innerHTML = '';

            data.categories.forEach(category => {
                const categoryEl = document.createElement('div');
                categoryEl.className = 'card';
                categoryEl.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${category.name}</span>
                        <button class="btn btn-sm btn-secondary" onclick="deleteCategoryConfirm('${category.id}')">üóëÔ∏è</button>
                    </div>
                    <div class="shortcuts-grid">
                        ${category.shortcuts.map(shortcut => `
                            <a href="${shortcut.url}" target="_blank" class="shortcut" 
                               oncontextmenu="openEditShortcut(event, '${category.id}', '${shortcut.id}')">
                                <div class="shortcut-icon ${shortcut.color}">${getInitials(shortcut.name)}</div>
                                <span class="shortcut-name">${shortcut.name}</span>
                            </a>
                        `).join('')}
                        <div class="shortcut add-shortcut" onclick="openAddShortcut('${category.id}')">
                            <div class="shortcut-icon">+</div>
                            <span class="shortcut-name">Ajouter</span>
                        </div>
                    </div>
                `;
                container.appendChild(categoryEl);
            });
        }

        function getInitials(name) {
            return name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
        }

        function openAddShortcut(categoryId) {
            currentCategoryId = categoryId;
            editingShortcut = null;
            document.getElementById('shortcutModalTitle').textContent = 'Ajouter un raccourci';
            document.getElementById('siteName').value = '';
            document.getElementById('siteUrl').value = '';
            document.getElementById('deleteShortcutBtn').style.display = 'none';
            selectColor('color-1');
            document.getElementById('shortcutModal').classList.add('active');
        }

        function openEditShortcut(e, categoryId, shortcutId) {
            e.preventDefault();
            currentCategoryId = categoryId;
            const category = data.categories.find(c => c.id === categoryId);
            editingShortcut = category.shortcuts.find(s => s.id === shortcutId);
            
            document.getElementById('shortcutModalTitle').textContent = 'Modifier le raccourci';
            document.getElementById('siteName').value = editingShortcut.name;
            document.getElementById('siteUrl').value = editingShortcut.url;
            document.getElementById('deleteShortcutBtn').style.display = 'block';
            selectColor(editingShortcut.color);
            document.getElementById('shortcutModal').classList.add('active');
        }

        function closeShortcutModal() {
            document.getElementById('shortcutModal').classList.remove('active');
        }

        function selectColor(color) {
            selectedColor = color;
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.color === color);
            });
        }

        function saveShortcut() {
            const name = document.getElementById('siteName').value.trim();
            let url = document.getElementById('siteUrl').value.trim();

            if (!name || !url) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            if (!url.startsWith('http')) url = 'https://' + url;

            const category = data.categories.find(c => c.id === currentCategoryId);

            if (editingShortcut) {
                editingShortcut.name = name;
                editingShortcut.url = url;
                editingShortcut.color = selectedColor;
            } else {
                category.shortcuts.push({
                    id: Date.now().toString(),
                    name, url,
                    color: selectedColor
                });
            }

            saveData();
            closeShortcutModal();
            renderShortcuts();
        }

        function deleteShortcut() {
            if (confirm('Supprimer ce raccourci ?')) {
                const category = data.categories.find(c => c.id === currentCategoryId);
                category.shortcuts = category.shortcuts.filter(s => s.id !== editingShortcut.id);
                saveData();
                closeShortcutModal();
                renderShortcuts();
            }
        }

        function openCategoryModal() {
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryModal').classList.add('active');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        function saveCategory() {
            const name = document.getElementById('categoryName').value.trim();
            if (!name) {
                alert('Veuillez entrer un nom');
                return;
            }

            data.categories.push({
                id: Date.now().toString(),
                name,
                shortcuts: []
            });

            saveData();
            closeCategoryModal();
            renderShortcuts();
        }

        function deleteCategoryConfirm(categoryId) {
            if (confirm('Supprimer cette cat√©gorie et tous ses raccourcis ?')) {
                data.categories = data.categories.filter(c => c.id !== categoryId);
                saveData();
                renderShortcuts();
            }
        }

        // ============ NEWS (RSS) ============
        async function loadNews() {
            const feeds = {
                'news-france': [
                    'https://www.lemonde.fr/rss/une.xml',
                    'https://www.francetvinfo.fr/titres.rss'
                ],
                'news-business': [
                    'https://www.lesechos.fr/rss/rss_une.xml',
                    'https://bfmbusiness.bfmtv.com/rss/info/flux-rss/flux-toutes-les-actualites/'
                ],
                'news-tech': [
                    'https://www.01net.com/rss/info/flux-rss/flux-toutes-les-actualites/',
                    'https://www.frandroid.com/feed'
                ],
                'news-energy': [
                    'https://www.actu-environnement.com/flux/rss/energie/',
                    'https://www.batiactu.com/feeds/rss/'
                ]
            };

            for (const [containerId, feedUrls] of Object.entries(feeds)) {
                loadFeed(containerId, feedUrls);
            }
        }

        async function loadFeed(containerId, feedUrls) {
            const container = document.getElementById(containerId);
            let allItems = [];

            for (const feedUrl of feedUrls) {
                try {
                    const response = await fetch(RSS_PROXY + encodeURIComponent(feedUrl));
                    const data = await response.json();
                    
                    if (data.status === 'ok' && data.items) {
                        allItems = allItems.concat(data.items.slice(0, 5).map(item => ({
                            title: item.title,
                            link: item.link,
                            pubDate: item.pubDate,
                            source: data.feed?.title || 'Source'
                        })));
                    }
                } catch (error) {
                    console.error('Error loading feed:', feedUrl, error);
                }
            }

            // Sort by date and limit
            allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
            allItems = allItems.slice(0, 8);

            if (allItems.length === 0) {
                container.innerHTML = '<div class="error-message">Impossible de charger les actualit√©s</div>';
                return;
            }

            container.innerHTML = allItems.map(item => {
                const timeAgo = getTimeAgo(new Date(item.pubDate));
                return `
                    <a href="${item.link}" target="_blank" class="news-item">
                        <div class="news-item-title">${item.title}</div>
                        <div class="news-item-meta">${item.source} ‚Ä¢ ${timeAgo}</div>
                    </a>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 60) return `Il y a ${diffMins} min`;
            if (diffHours < 24) return `Il y a ${diffHours}h`;
            return `Il y a ${diffDays}j`;
        }

        // ============ WEATHER (OpenWeatherMap) ============
        async function loadWeather() {
            const city = data.settings.weatherCity || 'Paris';
            const apiKey = data.settings.weatherApiKey;
            
            document.getElementById('weatherCityDisplay').textContent = city;
            document.getElementById('weatherRefresh').classList.add('loading');

            if (!apiKey) {
                document.getElementById('weatherWidget').innerHTML = `
                    <div class="error-message" style="width: 100%;">
                        ‚ö†Ô∏è Veuillez ajouter votre cl√© API OpenWeatherMap dans les param√®tres pour voir la m√©t√©o.<br>
                        <a href="https://openweathermap.org/api" target="_blank" style="color: #4facfe;">Obtenir une cl√© gratuite</a>
                    </div>
                `;
                document.getElementById('weatherForecast').innerHTML = '';
                document.getElementById('weatherRefresh').classList.remove('loading');
                return;
            }

            try {
                // Current weather
                const currentResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=fr`
                );
                
                if (!currentResponse.ok) throw new Error('API Error');
                
                const current = await currentResponse.json();

                // Forecast
                const forecastResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=fr`
                );
                const forecast = await forecastResponse.json();

                const weatherIcon = getWeatherIcon(current.weather[0].icon);
                
                document.getElementById('weatherWidget').innerHTML = `
                    <div class="weather-main">
                        <div class="weather-icon">${weatherIcon}</div>
                        <div class="weather-temp">${Math.round(current.main.temp)}¬∞C</div>
                        <div class="weather-desc">${current.weather[0].description}</div>
                    </div>
                    <div class="weather-details">
                        <div class="weather-detail">
                            <div class="weather-detail-value">${Math.round(current.main.feels_like)}¬∞</div>
                            <div class="weather-detail-label">Ressenti</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-value">${current.main.humidity}%</div>
                            <div class="weather-detail-label">Humidit√©</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-value">${Math.round(current.wind.speed * 3.6)} km/h</div>
                            <div class="weather-detail-label">Vent</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-value">${current.clouds.all}%</div>
                            <div class="weather-detail-label">Nuages</div>
                        </div>
                    </div>
                `;

                // Process forecast (get one per day at noon)
                const dailyForecast = {};
                forecast.list.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dateStr = date.toDateString();
                    const hour = date.getHours();
                    
                    if (!dailyForecast[dateStr] || Math.abs(hour - 12) < Math.abs(dailyForecast[dateStr].hour - 12)) {
                        dailyForecast[dateStr] = {
                            ...item,
                            hour,
                            date
                        };
                    }
                });

                const days = Object.values(dailyForecast).slice(0, 5);
                const dayNames = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];

                document.getElementById('weatherForecast').innerHTML = days.map(day => `
                    <div class="forecast-day">
                        <div class="forecast-day-name">${dayNames[day.date.getDay()]}</div>
                        <div class="forecast-day-icon">${getWeatherIcon(day.weather[0].icon)}</div>
                        <div class="forecast-day-temp">${Math.round(day.main.temp_max)}¬∞</div>
                        <div class="forecast-day-temp-min">${Math.round(day.main.temp_min)}¬∞</div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Weather error:', error);
                document.getElementById('weatherWidget').innerHTML = `
                    <div class="error-message" style="width: 100%;">
                        ‚ùå Erreur lors du chargement de la m√©t√©o. V√©rifiez votre cl√© API et le nom de la ville.
                    </div>
                `;
            }

            document.getElementById('weatherRefresh').classList.remove('loading');
        }

        function getWeatherIcon(iconCode) {
            const icons = {
                '01d': '‚òÄÔ∏è', '01n': 'üåô',
                '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
                '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è',
                '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è',
                '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
                '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è',
                '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
            };
            return icons[iconCode] || 'üå°Ô∏è';
        }

        // ============ NOTES ============
        function renderNotes() {
            const list = document.getElementById('notesList');
            
            if (data.notes.length === 0) {
                list.innerHTML = '<div style="opacity: 0.5; padding: 20px; text-align: center;">Aucune note</div>';
                return;
            }

            list.innerHTML = data.notes.map(note => `
                <div class="note-item ${currentNoteId === note.id ? 'active' : ''}" onclick="selectNote('${note.id}')">
                    <div class="note-title">${note.title || 'Sans titre'}</div>
                    <div class="note-preview">${note.content.substring(0, 60) || 'Note vide...'}</div>
                    <div class="note-date">${new Date(note.updated || note.created).toLocaleDateString('fr-FR')}</div>
                </div>
            `).join('');
        }

        function createNote() {
            const note = {
                id: Date.now().toString(),
                title: '',
                content: '',
                created: new Date().toISOString(),
                updated: new Date().toISOString()
            };
            data.notes.unshift(note);
            currentNoteId = note.id;
            saveData();
            renderNotes();
            showNoteEditor(note);
        }

        function selectNote(id) {
            currentNoteId = id;
            const note = data.notes.find(n => n.id === id);
            renderNotes();
            showNoteEditor(note);
        }

        function showNoteEditor(note) {
            document.getElementById('noteEditorPlaceholder').style.display = 'none';
            const editor = document.getElementById('noteEditor');
            editor.style.display = 'flex';
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteContent').value = note.content;
        }

        function saveNote() {
            if (!currentNoteId) return;
            const note = data.notes.find(n => n.id === currentNoteId);
            if (note) {
                note.title = document.getElementById('noteTitle').value;
                note.content = document.getElementById('noteContent').value;
                note.updated = new Date().toISOString();
                saveData();
                renderNotes();
            }
        }

        function deleteNote() {
            if (confirm('Supprimer cette note ?')) {
                data.notes = data.notes.filter(n => n.id !== currentNoteId);
                currentNoteId = null;
                document.getElementById('noteEditor').style.display = 'none';
                document.getElementById('noteEditorPlaceholder').style.display = 'block';
                saveData();
                renderNotes();
            }
        }

        // ============ TODOS ============
        function renderTodos() {
            const list = document.getElementById('todoList');
            
            if (data.todos.length === 0) {
                list.innerHTML = '<div style="opacity: 0.5; padding: 20px; text-align: center;">Aucune t√¢che</div>';
                return;
            }

            list.innerHTML = data.todos.map(todo => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
                    <div class="todo-checkbox" onclick="toggleTodo('${todo.id}')">
                        ${todo.completed ? '‚úì' : ''}
                    </div>
                    <span class="todo-text">${todo.text}</span>
                    <span class="todo-delete" onclick="deleteTodo('${todo.id}')">‚úï</span>
                </div>
            `).join('');
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            if (!text) return;

            data.todos.unshift({
                id: Date.now().toString(),
                text,
                completed: false,
                created: new Date().toISOString()
            });

            input.value = '';
            saveData();
            renderTodos();
        }

        function toggleTodo(id) {
            const todo = data.todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveData();
                renderTodos();
            }
        }

        function deleteTodo(id) {
            data.todos = data.todos.filter(t => t.id !== id);
            saveData();
            renderTodos();
        }

        // ============ CURRENCY (Free API) ============
        async function loadCurrency() {
            document.getElementById('currencyRefresh').classList.add('loading');
            
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/EUR');
                const rates = await response.json();

                const currencies = [
                    { code: 'USD', name: 'Dollar US', icon: 'üá∫üá∏' },
                    { code: 'GBP', name: 'Livre Sterling', icon: 'üá¨üáß' },
                    { code: 'CHF', name: 'Franc Suisse', icon: 'üá®üá≠' },
                    { code: 'ILS', name: 'Shekel', icon: 'üáÆüá±' },
                    { code: 'JPY', name: 'Yen', icon: 'üáØüáµ' },
                    { code: 'CAD', name: 'Dollar Canadien', icon: 'üá®üá¶' }
                ];

                document.getElementById('currencyGrid').innerHTML = currencies.map(c => `
                    <div class="currency-card">
                        <div class="currency-icon">${c.icon}</div>
                        <div class="currency-info">
                            <div class="currency-name">EUR ‚Üí ${c.code}</div>
                            <div class="currency-value">${rates.rates[c.code]?.toFixed(4) || 'N/A'}</div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Currency error:', error);
                document.getElementById('currencyGrid').innerHTML = `
                    <div class="error-message">Impossible de charger les taux de change</div>
                `;
            }

            document.getElementById('currencyRefresh').classList.remove('loading');
        }

        async function loadCrypto() {
            document.getElementById('cryptoRefresh').classList.add('loading');
            
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,ripple&vs_currencies=eur&include_24hr_change=true');
                const prices = await response.json();

                const cryptos = [
                    { id: 'bitcoin', code: 'BTC', name: 'Bitcoin', icon: '‚Çø' },
                    { id: 'ethereum', code: 'ETH', name: 'Ethereum', icon: 'Œû' },
                    { id: 'solana', code: 'SOL', name: 'Solana', icon: '‚óé' },
                    { id: 'ripple', code: 'XRP', name: 'Ripple', icon: '‚úï' }
                ];

                document.getElementById('cryptoGrid').innerHTML = cryptos.map(c => {
                    const price = prices[c.id]?.eur;
                    const change = prices[c.id]?.eur_24h_change;
                    return `
                        <div class="currency-card">
                            <div class="currency-icon">${c.icon}</div>
                            <div class="currency-info">
                                <div class="currency-name">${c.code}</div>
                                <div class="currency-value">${price ? price.toLocaleString('fr-FR', { maximumFractionDigits: 2 }) + ' ‚Ç¨' : 'N/A'}</div>
                                ${change !== undefined ? `
                                    <div class="currency-change ${change >= 0 ? 'up' : 'down'}">
                                        ${change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(change).toFixed(2)}%
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Crypto error:', error);
                document.getElementById('cryptoGrid').innerHTML = `
                    <div class="error-message">Impossible de charger les cryptos</div>
                `;
            }

            document.getElementById('cryptoRefresh').classList.remove('loading');
        }

        // ============ JEWISH CALENDAR (Hebcal API) ============
        async function loadJewishCalendar() {
            const city = data.settings.jewishCity || 'Paris';
            document.getElementById('shabbatCity').textContent = city;

            // City coordinates for Hebcal
            const cities = {
                'Paris': { lat: 48.8566, lon: 2.3522, tzid: 'Europe/Paris' },
                'Marseille': { lat: 43.2965, lon: 5.3698, tzid: 'Europe/Paris' },
                'Lyon': { lat: 45.764, lon: 4.8357, tzid: 'Europe/Paris' },
                'Nice': { lat: 43.7102, lon: 7.262, tzid: 'Europe/Paris' },
                'Strasbourg': { lat: 48.5734, lon: 7.7521, tzid: 'Europe/Paris' },
                'Jerusalem': { lat: 31.7683, lon: 35.2137, tzid: 'Asia/Jerusalem' },
                'Tel Aviv': { lat: 32.0853, lon: 34.7818, tzid: 'Asia/Jerusalem' },
                'New York': { lat: 40.7128, lon: -74.006, tzid: 'America/New_York' },
                'London': { lat: 51.5074, lon: -0.1278, tzid: 'Europe/London' }
            };

            const cityData = cities[city] || cities['Paris'];

            try {
                // Get Shabbat times and parasha
                const shabbatResponse = await fetch(
                    `https://www.hebcal.com/shabbat?cfg=json&latitude=${cityData.lat}&longitude=${cityData.lon}&tzid=${cityData.tzid}&M=on`
                );
                const shabbat = await shabbatResponse.json();

                // Find candle lighting and havdalah
                let candleLighting = '--:--';
                let havdalah = '--:--';
                let parasha = { name: '--', hebrew: '--' };

                shabbat.items?.forEach(item => {
                    if (item.category === 'candles') {
                        candleLighting = new Date(item.date).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                    }
                    if (item.category === 'havdalah') {
                        havdalah = new Date(item.date).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                    }
                    if (item.category === 'parashat') {
                        parasha = { name: item.title, hebrew: item.hebrew || '' };
                    }
                });

                document.getElementById('shabbatIn').textContent = candleLighting;
                document.getElementById('shabbatOut').textContent = havdalah;
                document.getElementById('parashaName').textContent = parasha.name;
                document.getElementById('parashaHebrew').textContent = parasha.hebrew;

                // Get Hebrew date
                const hebrewDateResponse = await fetch('https://www.hebcal.com/converter?cfg=json&date=' + new Date().toISOString().split('T')[0] + '&g2h=1');
                const hebrewDate = await hebrewDateResponse.json();
                document.getElementById('hebrewDate').textContent = hebrewDate.hebrew || '';

                // Get upcoming holidays
                const year = new Date().getFullYear();
                const holidaysResponse = await fetch(
                    `https://www.hebcal.com/hebcal?v=1&cfg=json&maj=on&min=on&mod=on&year=${year}&month=x`
                );
                const holidays = await holidaysResponse.json();

                const now = new Date();
                const upcomingHolidays = holidays.items
                    ?.filter(h => new Date(h.date) >= now && h.category === 'holiday')
                    .slice(0, 6);

                if (upcomingHolidays?.length) {
                    document.getElementById('holidaysList').innerHTML = upcomingHolidays.map(h => `
                        <div class="holiday-item">
                            <div class="holiday-name">
                                <strong>${h.title}</strong>
                                <span class="holiday-hebrew">${h.hebrew || ''}</span>
                            </div>
                            <div style="opacity: 0.7;">${new Date(h.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' })}</div>
                        </div>
                    `).join('');
                }

            } catch (error) {
                console.error('Jewish calendar error:', error);
                document.getElementById('holidaysList').innerHTML = `
                    <div class="error-message">Impossible de charger le calendrier</div>
                `;
            }
        }

        // ============ SETTINGS ============
        function saveSettings() {
            data.settings.weatherCity = document.getElementById('weatherCity').value.trim() || 'Paris';
            data.settings.jewishCity = document.getElementById('jewishCity').value;
            data.settings.userName = document.getElementById('userName').value.trim();
            data.settings.weatherApiKey = document.getElementById('weatherApiKey').value.trim();
            
            saveData();
            
            // Reload affected sections
            updateDateTime();
            loadWeather();
            loadJewishCalendar();
            
            alert('‚úÖ Param√®tres enregistr√©s !');
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dashboard-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('Remplacer toutes vos donn√©es actuelles par celles import√©es ?')) {
                        data = imported;
                        saveData();
                        location.reload();
                    }
                } catch (error) {
                    alert('Erreur: fichier invalide');
                }
            };
            reader.readAsText(file);
        }

        function resetData() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr ? Toutes vos donn√©es seront perdues d√©finitivement.')) {
                localStorage.removeItem('dashboardDataV2');
                location.reload();
            }
        }

        // ============ STORAGE ============
        function saveData() {
            localStorage.setItem('dashboardDataV2', JSON.stringify(data));
        }

        // ============ START ============
        init();
    </script>
</body>
</html>
